(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{456:function(e,t){},458:function(e,t){},499:function(e,t){},500:function(e,t){},502:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=502},529:function(e,t,n){"use strict";n.r(t);var a=n(89),l=n(13),o=n(15),r=n(16),c=n(19),s=n(17),i=n(18),u=n(0),m=n.n(u),d=n(9),p=n.n(d),v=n(30),f=n(98),h=n.n(f),E=n(107),g=n.n(E),b=n(29),N=n(282),C=n.n(N),y=n(283),w=n.n(y),S=n(85),k=n.n(S),z=function(e,t,n,a,l,o,r){return{defaultFileName:r,pageSize:{width:450,height:"auto"},fillColor:"red",pageMargins:[35,40,35,40],content:[{image:"data:image/png;base64,"+e,width:100,style:{alignment:"center"}},{lineHeight:2,text:"COUPON DE REDUCTION",fontSize:15,style:{alignment:"center",bold:!0}},{text:[{text:t+" \n",fontSize:14,style:{alignment:"center",bold:!0}},{text:"Vous b\xe9neficiez d'une reduction de "+n+" \n",fontSize:14,color:"#de0027",style:{alignment:"center"}},{text:"Pour l'annonce: "+l+" \n",fontSize:14,style:{alignment:"center"}},{text:"\nOffre valable jusqu'au "+a+" sous pr\xe9sentation au guichet. \n\n",fontSize:10,style:{italics:!0,alignment:"center"}}]},{text:"\n www.entrecops.co",fontSize:10,style:{italics:!0,alignment:"center"}}]}};C.a.vfs=w.a.pdfMake.vfs;var M=n(446),O=function(e){function t(){var e,n;Object(o.a)(this,t);for(var r=arguments.length,i=new Array(r),u=0;u<r;u++)i[u]=arguments[u];return(n=Object(c.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(i)))).state={showModal:!1,error:"",loading:!1,selectedAnnonce:null,eventType:"",event:null,events:[],eventsLoading:!0,services:[],service:null,servicesLoading:!0,nCoupons:"",infos:"",datelimite:"",montant:"",couponValid:!1,couponError:"",removing:!1},n.handleInputChange=function(e){e.preventDefault();var t=e.target.name,a=e.target.value;n.setState(Object(l.a)({},t,a),n.validate)},n.validate=function(){var e=n.state,t=e.nCoupons,a=e.infos,l=e.datelimite,o=e.montant;n.setState({couponValid:t.trim().length>0&&a.trim().length>0&&l.trim().length>0&&o.trim().length>0})},n.openModal=function(e,t){n.setState({showModal:!0,loading:!0,eventType:t});var a="/api/"+t+"/"+e;p.a.get(a).then(function(e){var a="event"===t?e.data.event:e.data.service;n.setState({selectedAnnonce:a,loading:!1})}).catch(function(e){n.setState({error:"Une erreur s'est produite. Veuillez re\xe9ssayer.",loading:!1})})},n.generateCoupon=function(){var e=n.state,t=e.nCoupons,o=e.montant,r=e.datelimite,c=e.infos,s=e.eventType,i=e.selectedAnnonce,u=[];i.coupons&&i.coupons.clients&&(u=Object(a.a)(i.coupons.clients)),n.setState({loading:!0});var m={nCoupons:t,montant:o,datelimite:r,title:i.title,infos:c,clients:u,image:v.a+"/"+i.image};p.a.patch(v.a+"/api/"+s+"/"+i._id+"/add/coupon",{coupon:m}).then(function(e){var t=("event"===s?n.state.events:n.state.services).filter(function(e){return e._id===i._id&&(e.coupons=m),e});M(k.a).then(function(e){var a=z(e,c,o,r,i.title,"Entrecops",i.title.split(" ").join("-"));C.a.createPdf(a).open(),n.setState(Object(l.a)({loading:!1,showModal:!1},s+"s",t))}).catch(function(e){return console.log(e)})}).catch(function(e){n.setState({loading:!1,couponError:"Une erreur s'est produite. Veuillez re\xe9ssayer."})})},n.previewCoupon=function(e){var t=e.coupons,n=t.infos,a=t.datelimite,l=t.montant;M(k.a).then(function(t){var o=z(t,n,l,a,e.title,"Entrecops",e.title.split(" ").join("-"));C.a.createPdf(o).open()}).catch(function(e){return console.log(e)})},n.removeCoupon=function(e,t){n.setState({removing:!0});var a=v.a+"/api/"+t+"/"+e+"/remove/coupon";p.a.patch(a).then(function(a){var o=("event"===t?n.state.events:n.state.services).filter(function(t){return t._id===e&&(t.coupons=null),t});n.setState(Object(l.a)({removing:!1},t+"s",o))}).catch(function(e){n.setState({error:"Une erreur s'est produite. Veuillez re\xe9ssayer.",loading:!1})})},n}return Object(i.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;p.a.get("/api/event/validated/all").then(function(t){e.setState({events:t.data.events,eventsLoading:!1,error:""})}).catch(function(t){e.setState({error:"Une \xe9rreur s'est produite. Veuillez re\xe9ssayer.",eventsLoading:!1})}),p.a.get("/api/service/validated/all").then(function(t){e.setState({services:t.data.services,servicesLoading:!1,error:""})}).catch(function(t){e.setState({error:"Une \xe9rreur s'est produite. Veuillez re\xe9ssayer.",servicesLoading:!1})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.error,a=t.events,l=t.eventsLoading,o=t.services,r=t.servicesLoading,c=t.selectedAnnonce,s=t.loading;return m.a.createElement(u.Fragment,null,m.a.createElement("div",{className:"container admin-coupons mt-4"},m.a.createElement("div",{className:"row pt-5 pb-3"},m.a.createElement("div",{className:"col"},m.a.createElement("h1",null,"Gen\xe9rer des coupons de r\xe9duction"))),m.a.createElement("div",{className:"row"},m.a.createElement("div",{className:"col-sm-12 py-3"},m.a.createElement("h4",{className:"mt-3"},"Liste des Ev\xe8nements")),m.a.createElement("div",{className:"col-sm-12"},n.length?m.a.createElement("div",{className:"alert alert-danger",style:{fontSize:"1.3rem"}},n):null,l?m.a.createElement("div",{className:"d-block mr-auto ml-auto text-center"},m.a.createElement(b.default,null)):a&&a.length?m.a.createElement("table",{className:"table table-bordered",id:"thetable"},m.a.createElement("thead",{className:"thead-inverse thead-dark"},m.a.createElement("tr",null,m.a.createElement("th",null,"#"),m.a.createElement("th",null,"Nom de l'\xe9venement"),m.a.createElement("th",null,"Coupons Restants"),m.a.createElement("th",null,"Actions"))),m.a.createElement("tbody",null,a.map(function(t,n){return m.a.createElement("tr",{key:t._id},m.a.createElement("th",{scope:"row"},n+1),m.a.createElement("td",null,t.title),m.a.createElement("td",null,t.coupons?t.coupons.nCoupons:0),m.a.createElement("td",{className:"actions text-right"},t.coupons?m.a.createElement(u.Fragment,null,m.a.createElement("button",{className:"btn btn-dark btn-lg mr-3",onClick:function(){return e.previewCoupon(t)}},"Afficher le coupon"),m.a.createElement("button",{className:"btn btn-outline-danger btn-lg",onClick:function(){return e.removeCoupon(t._id,"event")}},"Annuler coupons")):m.a.createElement("button",{className:"btn btn-danger btn-lg mr-3",onClick:function(){return e.openModal(t._id,"event")}},"G\xe9n\xe9rer des coupons")))}))):null)),m.a.createElement("div",{className:"row mt-4"},m.a.createElement("div",{className:"col-sm-12 py-3"},m.a.createElement("h4",{className:"mt-3"},"Liste des Services")),m.a.createElement("div",{className:"col-sm-12"},n.length?m.a.createElement("div",{className:"alert alert-danger",style:{fontSize:"1.3rem"}},n):null,r?m.a.createElement("div",{className:"d-block mr-auto ml-auto text-center"},m.a.createElement(b.default,null)):o&&o.length?m.a.createElement("table",{className:"table table-bordered"},m.a.createElement("thead",{className:"thead-inverse thead-dark"},m.a.createElement("tr",null,m.a.createElement("th",null,"#"),m.a.createElement("th",null,"Nom du service"),m.a.createElement("th",null,"Coupons Restants"),m.a.createElement("th",null,"Actions"))),m.a.createElement("tbody",null,o.map(function(t,n){return m.a.createElement("tr",{key:t._id},m.a.createElement("th",{scope:"row"},n+1),m.a.createElement("td",null,t.title),m.a.createElement("td",null,t.coupons?t.coupons.nCoupons:0),m.a.createElement("td",{className:"actions"},t.coupons?m.a.createElement(u.Fragment,null,m.a.createElement("button",{className:"btn btn-dark btn-lg mr-3",onClick:function(){return e.previewCoupon(t)}},"Afficher le coupon"),m.a.createElement("button",{className:"btn btn-outline-danger btn-lg",onClick:function(){return e.removeCoupon(t._id,"service")}},"Annuler coupons")):m.a.createElement("button",{className:"btn btn-danger btn-lg mr-3",onClick:function(){return e.openModal(t._id,"service")}},"G\xe9n\xe9rer des coupons")))}))):null))),m.a.createElement(h.a,{show:this.state.showModal,onHide:function(){return e.setState({showModal:!e.state.showModal})}},m.a.createElement(h.a.Header,{closeButton:!0},m.a.createElement(h.a.Title,null,"G\xe9n\xe9rer des coupons")),m.a.createElement(h.a.Body,null,m.a.createElement("div",{className:"container"},m.a.createElement("div",{className:"row"},s?m.a.createElement("div",{className:"d-block mr-auto ml-auto text-center"},m.a.createElement(b.default,null)):c?m.a.createElement("div",{className:"col-sm-12 pl-4 pr-4 mt-4 mb-3"},this.state.couponValid?null:m.a.createElement("div",{className:"alert alert-danger mb-4"},"Veuillez remplis tous les champs"),m.a.createElement("div",{className:"pb-3"},m.a.createElement("h4",null,"Coupons pour: \xa0",m.a.createElement("b",null,c.title))),m.a.createElement("div",{className:"form-group"},m.a.createElement("label",{for:"name"},"Infos sur la r\xe9duction"),m.a.createElement("input",{type:"text",onChange:function(t){return e.handleInputChange(t)},value:this.state.infos,name:"infos",className:"form-control",placeholder:"Informations"})),m.a.createElement("div",{className:"form-group"},m.a.createElement("label",{for:"name"},"Montant / Poucentage de reduction"),m.a.createElement("input",{type:"text",onChange:function(t){return e.handleInputChange(t)},value:this.state.montant,name:"montant",className:"form-control",placeholder:"Montant / Pourcentage"})),m.a.createElement("div",{className:"form-group"},m.a.createElement("label",{for:"name"},"Date limite de validit\xe9"),m.a.createElement("input",{type:"text",onChange:function(t){return e.handleInputChange(t)},value:this.state.datelimite,name:"datelimite",className:"form-control",placeholder:"Date limite de validit\xe9"})),m.a.createElement("div",{className:"form-group"},m.a.createElement("label",{for:"ncoupons"},"Nombre de coupons"),m.a.createElement("input",{type:"number",onChange:function(t){return e.handleInputChange(t)},value:this.state.nCoupons,name:"nCoupons",className:"form-control",placeholder:"Nombre de coupons"})),m.a.createElement("div",{className:"couponwrap",id:"couponwrap"})):null))),m.a.createElement(h.a.Footer,null,m.a.createElement("div",{className:"py-3"},m.a.createElement(g.a,{disabled:!this.state.couponValid,variant:"danger",onClick:this.generateCoupon},"G\xe9n\xe9rer"),m.a.createElement(g.a,{variant:"default",className:"ml-4",onClick:function(){return e.setState({showModal:!1})}},"Fermer")))))}}]),t}(u.Component);t.default=O}}]);
//# sourceMappingURL=36.0083c60a.chunk.js.map